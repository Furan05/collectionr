<div class="card-detail-container">
  <div class="card-inf">
    <div class="card-imag" data-tilt data-tilt-glare data-tilt-max-glare="0.4">
      <% if @card.tcg == "pokemon" %>
        <img src="<%= @card_info["images"]["large"] %>" alt="<%= @card_info["name"] %>">
      <% elsif @card.tcg == "yugiho" %>
        <img src="<%= @card_info["card_images"][0]["image_url"] %>" alt="<%= @card_info["name"] %>">
      <% end %>
    </div>

    <div class="card-stats">
      <h1><%= @card_info["name"] %></h1>

      <div class="price-history">
        <h2><i class='bx bx-line-chart' ></i> Évolution du prix (30j)</h2>
        <canvas id="priceChart"></canvas>
      </div>


      <div class="stats-grid">
        <% if @card.tcg == "pokemon" %>
          <div class="stat-item">
            <h3><i class='bx bx-list-ul' ></i> Set</h3>
            <p><%= @card_info["set"]["name"] %></p>
          </div>

          <div class="stat-item">
            <h3><i class='bx bxs-bolt'></i> Rarity</h3>
            <p><%= @card_info["rarity"] %></p>
          </div>

          <div class="stat-item">
            <h3><i class='bx bx-paint' ></i> Artist</h3>
            <p><%= @card_info["artist"] %></p>
          </div>

          <div class="stat-item">
            <h3><i class='bx bx-radio-circle' ></i> Number</h3>
            <p><%= @card_info["number"] %>/<%= @card_info["set"]["total"] %></p>
          </div>
        <% elsif @card.tcg == "yugiho" %>
          <div class="stat-item">
            <h3>Type</h3>
            <p><%= @card_info["type"] %></p>
          </div>

          <div class="stat-item">
            <h3>Race</h3>
            <p><%= @card_info["race"] %></p>
          </div>

          <div class="stat-item">
            <h3>Archetype</h3>
            <p><%= @card_info["archetype"] || "N/A" %></p>
          </div>

          <% if @card_info["atk"].present? %>
            <div class="stat-item">
              <h3>ATK/DEF</h3>
              <p><%= @card_info["atk"] %>/<%= @card_info["def"] %></p>
            </div>
          <% end %>
        <% end %>
      </div>

      <% if @card.tcg == "pokemon" && @card_info["attacks"] %>
        <div class="attacks">
          <h3><i class='bx bx-bolt-circle' ></i> Attacks</h3>
          <% @card_info["attacks"].each do |attack| %>
            <div class="attack">
              <h4><%= attack["name"] %></h4>
              <p><%= attack["text"] %></p>
            </div>
          <% end %>
        </div>
      <% elsif @card.tcg == "yugiho" %>
        <div class="description">
          <h3>Description</h3>
          <p><%= @card_info["desc"] %></p>
        </div>
      <% end %>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const priceData = <%= raw @price_history.to_json %>;
    const ctx = document.getElementById('priceChart').getContext('2d');

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: priceData.map(item => item.date),
        datasets: [{
          label: 'Prix de la carte (€)',
          data: priceData.map(item => item.price),
          borderColor: '#f8c471',
          backgroundColor: 'rgba(248, 196, 113, 0.1)',
          borderWidth: 2,
          tension: 0.4,
          fill: true,
          pointRadius: 0,
          pointHoverRadius: 6,
          pointHoverBackgroundColor: '#f8c471',
          pointHoverBorderColor: '#fff',
          pointHoverBorderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              display: false
            },
            ticks: {
              font: {
                size: 12
              }
            }
          },
          x: {
            grid: {
              display: false
            },
            ticks: {
              font: {
                size: 12
              },
              maxTicksLimit: 6,
              maxRotation: 0
            }
          }
        },
        interaction: {
          intersect: false,
          mode: 'index'
        }
      }
    });
  });
</script>
